#region Prolog
vNow     = TIMST (NOW(), '\Y\m\d\h\i\s' );
# User infos
vUser = 'apikey';
vAPIKey = 'azE6dXNyX2RjYzBmZWY4LTBmYjktM2M0NS1hMmQ2LWRhYWNmYzJhMjYzMDo4OEQ1czBPL0ZYNkFKMG1QS3lwZzhKbVZIaHVaUlBUL2Y1ckhJejF5Q3dJPTpoT09D' ;
vCredentials = vUser | ':' | vAPIKey;
# Env infos
vHost ='https://eu-central-1.planninganalytics.saas.ibm.com';
vTenant = 'DDZZBR27IKOU' ;
vDBS = 'Region03';
vDBT = 'Test_Git' ;
vCube = 'A_Balance Sheet';

## Th odata type of the source view must be as followed:   "@odata.type": "#ibm.tm1.api.v1.MDXView",
## The http request (GET type) must be as followed : https://eu-central-1.planninganalytics.saas.ibm.com/api/DDZZBR27IKOU/v0/tm1/Test_Git/api/v1/Cubes('plan_BudgetPlan')/Views('01 - Small')
## The strategy is to:
## 1 - retreive the MDX expression from the source in the body response of the get request  - e.g. :     "MDX": "SELECT my very long MDX expression from my source app)",
## 2 - create the view in the target environnement
## 3 - Retreive data from the source  view
## 4 - Insert the previoulsy retreived data  in the target


###----------------------------------------------------------------------------------------------------------------------###

sTokenUrlS = vHost| '/api/'| vTenant | '/v0/tm1/' | vDBS | '/api/v1/Cubes('| vCube |')/tm1.Update';



#Send data in target using the tm1.Update call and a tuple
sDatas = '
	{"Cells":[
	    {"Tuple@odata.bind": [
	        "Dimensions(''A_Organization'')/Hierarchies("A_Organization'')/Elements(''117'')",
	        "Dimensions(''A_Year'')/Hierarchies(''A_Year'')/Elements(''Y1'')",
	        "Dimensions("A_Month'')/Hierarchies(''A_Month'')/Elements(''Jan'')",
	        "Dimensions(''A_Version'')/Hierarchies("A_Version'')/Elements(''Actual'')",
	        "Dimensions(''B_Change'')/Hierarchies(''B_Change'')/Elements(''Balance'')",
          "Dimensions(''A_Account'')/Hierarchies(''A_Account'')/Elements("6300'')"
	        ]
	    }
    ],
	"Value":"0.32"}
';


#endregion
#region Data
ExecuteHttpRequest( 'POST', sTokenUrlS , '-u '| vCredentials , '-h Content-Type:application/json; charset=utf-8', '-d' | sDatas );
sResponseBodyCellsetID = HttpResponseGetBody();
nResponseCodeCellsetID = HttpResponseGetStatusCode();

ASCIIOutput('/Output/body_POST_CCE.json', NumberToString( nResponseCodeCellsetID) , NumberToString( LONG(sResponseBodyCellsetID) ));
#endregion